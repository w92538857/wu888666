<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<script>
			function search(){
				//如何获取到地址栏传递的uid---string API
				//使用url对象操作，获取查询字符串的数据
				var urlParams=new URLSearchParams(location.search);
				var $uid=urlParams.get("uid");
				//1.创建xhr异步对象
				var xhr=new XMLHttpRequest();
				//4.接收响应
				xhr.onreadystatechange=function(){
					if(xhr.readyState==4&& xhr.status==200){
						var r=xhr.responseText;
						if(r==0){
							alert("查询失败");
						}else{
							var arr=JSON.parse(r);
							uname.value=arr.uname;
							email.value=arr.email;
							phone.value=arr.phone;
							user_name.value=arr.user_name;
							//操作单选按钮
							if(arr.gender==1){
								man.checked=true;
							}else if(arr.gender==0){
								woman.checked=true;
							}else{
								unk.checked=true;
							}
						}
					}
				}
				//2.创建请求
				xhr.open("get","/pro/v1/search/"+$uid,true);
				//3.发送请求
				xhr.send();
			}
			
			function update(){
				//获取地址查询字符中的uid
				var urlParams=new URLSearchParams(location.search);
				var $uid=urlParams.get("uid");
				var $uname=uname.value;
				var $email=email.value;
				var $phone=phone.value;
				var $user_name=user_name.value;
				var $gender=-1;
				if(man.checked==true){
					$gender=1;
				}else if(woman.checked==true){
					$gender=0;
				}else{
					$gender=-1;
				}
				//1.创建xhr异步对象
				var xhr=new XMLHttpRequest();
				//4.接收响应
				xhr.onreadystatechange=function(){
					if(xhr.readyState==4&&xhr.status==200){
						var r=xhr.responseText;
						if(r==1){
							alert("修改成功");
							location.href="pro_list.html";
						}else{
							alert("修改失败");
						}
					}
				}
				//2.创建请求,打开连接
				xhr.open("put","/pro/v1/update",true);
				//3.发送请求
				xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
				var formdata=`uid=${$uid}&uname=${$uname}&email=${$email}&phone=${$phone}&user_name=${$user_name}&gender=${$gender}`;
				xhr.send(formdata);
			}
		</script>
	</head>
	<body onload="search()">
		<!-- <input type="text" id="uid"><br>
		<button onclick="search()">查询</button><br> -->
		<input type="text" id="uname"><br>
		<input type="text" id="email"><br>
		<input type="text" id="phone"><br>
		<input type="text" id="user_name"><br>
		<input type="radio" name="gender" id="man" value="1">男  
		<input type="radio" name="gender" id="woman" value="0">女 
		<input type="radio" name="gender" id="unk" value="-1">保密<br>
		<button onclick="update()">修改</button>
		<br>
	</body>
</html>
